# Pipeline utilisé par les enseignant
# 
# Sert à automatiquement créé les fichiers ZIP pour les exercices et exemples de la semaine
name: CI/CD Pipeline

on:
  workflow_dispatch:

jobs:

  generate_zips_for_week_and_commit : 

    runs-on: self-hosted   # Agent onprem à même le cluster Kubernetes pour réaliser l'exécution du build (machine linux)
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup python and run script
      uses: actions/setup-python@v5
      with:
        python-version: '3.13' 

    - name: Set up virtual environment
      run: |
        python -m venv venv
        source venv/bin/activate

    - name: Install dependency and run the python script to generate the ZIP files                                                                            
      run: |  
        pip install gitpython                                                  
        python -u generate-zips-for-week.py configuration-fichier-r01-r02.json 
        
    - name: Copy the generated ZIP files from the output directory to the zip-generated directory
      run: |
        find output -maxdepth 1 -type f -name "*.zip" -exec cp {} zip-generated \;      

    - name : Commit all changed files back to the repository                            
      uses: stefanzweifel/git-auto-commit-action@v5
